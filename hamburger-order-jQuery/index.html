<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
        <script src="./dist/vf-runtime-client.js"></script>
    </head>
    <body>
        <input id="user-input" type="text" placeholder="Enter your response...">
        <button id="send" type="button">Start</button>
        <ul id="root"></ul>

        <script defer>
            // Import from the vfrc global
            const { default: RuntimeClientFactory, TraceType, TraceEvent } = vfrc;

            // Create a RuntimeClient instance to connect to your Voiceflow app
            const factory = new RuntimeClientFactory({
                versionID: 'XXXX',
                apiKey: 'VF.XXXX.XXXX',
            });
            const chatbot = factory.createClient();

            // Create state to track if the conversation has ended. This might affect how we render our UI.
            let isEnd = true;

            // Handler runs when a data is received from Runtime servers
            chatbot.on(TraceEvent.BEFORE_PROCESSING, (context) => {
                // Update our UI state
                isEnd = context.isEnding()

                // Clear the user interface when the response arrives
                $("#root").empty();

                // Change the button depending on if the conversation started or stopped
                $("#send").text(isEnd ? 'Start' : 'Send');
            });

            // Handler runs when we iterate over a Speak Trace in the chatbot's response
            chatbot.on(TraceType.SPEAK, (trace) => {
                // Add the new response to the chat window
                $("#root").append(`<li>${trace.payload.message}</li>`)
            });

            // Click handler - This advanced the conversation session
            async function handleSend() {
                // Get the user's response to the VF App's dialogue
                const userInput = $("#user-input").val();

                // Call an Interaction Method to start the conversation or advance the conversation based on `userInput`
                const context = isEnd ? await chatbot.start() : await chatbot.sendText(userInput);
            }

            $("#send").on("click", handleSend);
        </script>
    </body>
</html>
