<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
        <script src="./dist/vf-runtime-client.js"></script>
    </head>
    <body>
        <input id="user-input" type="text" placeholder="Enter your response...">
        <button id="send" type="button">Start</button>
        <ul id="root"></ul>

        <script defer>
            // Import from the vfrc global
            const { default: RuntimeClientFactory, makeTraceProcessor } = vfrc;

            // Create a RuntimeClient instance to connect to your Voiceflow app
            const factory = new RuntimeClientFactory({
                versionID: 'XXXXXXXXXXXXXXXXXX'
            });
            const chatbot = factory.createClient();

            // Create state to track if the conversation has ended. This might affect how we render our UI.
            let isEnd = true;

            // When we receive a response from our VF app, then display the messages on the web-page.
            function displayResponse(messages) {
                $("#root").empty();
                messages.forEach(text => $("#root").append(`<li>${text}</li>`));
            }

            // The main workhorse function
            async function handleSend() {
                // Get the user's response to the VF App's dialogue
                const userInput = $("#user-input").val();

                // Call an Interaction Method to start the conversation or advance the conversation based on userInput
                const context = isEnd ? await chatbot.start() : await chatbot.sendText(userInput);

                // Store the VF app's response and/or display on the UI               
                isEnd = context.isEnding();
                $("#send").text(isEnd ? 'Start' : 'Send');
                displayResponse(context.getResponse().map(trace => trace.payload.message));
            }

            $("#send").on("click", handleSend);
        </script>
    </body>
</html>
